---
layout: post
title:  做市商策略模型
category: [数学,金融] 
description: 做市商策略模型是一类被广泛采用的交易模型，对于国外来说，这类策略更多的是被叫做"High Frequency Trading"，因为其涉及到市场微观结构，因此常常策略实施的时间非常短，这也导致这类策略的研究方式和传统趋势策略等有所不同。这篇博客将详细论述一篇国外论文，来初探做市商策略的基本研究框架。
---
## 一、现代交易所模型
在介绍做市商策略之前，我们要首先介绍一下各类证券交易的机制。现代交易机制都是基于报价订单（Order）这个概念进行的。可以这样说，交易所就是一系列订单流构成，因此一个交易所抽象出来就是一个订单流。那么这个订单流是如何组织起来的呢，又是如何完成交易这个职能的呢。我们看某一时刻$$t_0$$，交易所(Order Book)的状态：

| type | price        | volume      |
| :--: |:------------:| :----------:|
| ...  | ...          | ...         |
| ask4 | $p_4^a$      |   $$v_4^a$$ |
| ask3 | $p_3^a$      |   $$v_3^a$$ |
| ask2 | $p_2^a$      |   $$v_2^a$$ |
| ask1 | $p_1^a$      |   $$v_1^a$$ |
| bid1 | $p_1^b$      |   $$v_1^b$$ |
| bid2 | $p_2^b$      |   $$v_2^b$$ |
| bid3 | $p_3^b$      |   $$v_3^b$$ |
| bid4 | $p_4^b$      |   $$v_4^b$$ |
| ...  | ...          | ...         |

这是一个典型的订单簿的形式，type表示这个订单的方向是买单(bid)，或者是卖单(ask)，price是报价，从逻辑上来说，越在订单簿上面的订单的报价越高，volume表示订单的报量。
我们所有对做市商策略都会基于这个订单簿进行讨论，也就是说如果一个做市商策略不和你讲订单簿，那基本上可以认为没啥价值。回到订单簿上来，这个订单簿是某一个时刻$$t_0$$的瞬时订单簿，随着时间的变化，新的订单会加入这个订单簿，并且改变订单簿。

例如，在$$t_0+\varDelta t$$有一个新的bid订单，报价和报量为$$(p_1^a,v_1^a)$$，我们发现这个订单与ask1的订单重合了，此时，交易所认为这两个订单匹配，并立即进行撮合，此时市场上发生了两件事情，在$$\varDelta t$$时间内成交了$$v_1^a$$的证券，并且成交价为$$p_1^a$$，同时，在$$t_0+\varDelta t$$时刻，订单簿改变了，原来的ask1消失，ask2变为新的ask1，后面依次类推。同理可得到，当新的ask订单主动与bid订单成交的情形。

当然，不是每次有新的订单来，都会引起上述两种市场事件的发生，还是以刚才的例子，若bid订单的报价位于$$p_1^a$$和$$p_1^b$$之间，那么不会发生成交，而只是改变了订单簿，在原来的bid1和ask1之间出现了新的bid订单，成为了新的bid1。

## 二、做市商策略模型

### 1.符号定义

当然，在开始的时候我们还是需要来定义一下几个符号：

- $$S_t$$表示$$t$$时刻的股价，一般认为是ask1和bid1价格的中间价，用以评估资产价值。
- $$w_t$$表示投资者在$$t$$时刻所持有的资产价值。
- $$x_t$$表示$$t$$时刻持有的现金。
- $$q_t$$表示$$t$$时刻持有的标的数量。
- $$p^a$$表示$$t$$时刻投资者报出的卖价。
- $$p^b$$表示$$t$$时刻投资者报出的买价。
- $$\delta^b=S_t-p^b$$表示标的中间价与买单报价的差。
- $$\delta^a=p^a-S_t$$表示标的卖单报价与中间价的差。
- $$p^Q$$为市场上成交价最高的价格，并记$\varDelta p = \|p^Q - S\|$

### 2. 模型假设

标的价格$$S_t$$满足方程：

$$dS_t = \sigma dW_t$$

同时，投资者的效用函数为：

$$
\begin{aligned}
U(w) &= -\frac{1}{e^{\gamma w}}\\
U(x,S,q,t)&=E_t(-\frac{1}{e^{\gamma (x_T+q_TS_T)} })
\end{aligned}
$$

### 3. 无订单模型

如果投资者没有任何的订单，那么在这样条件下的效用函数为：

$$
\begin{aligned}
    U(x,S,q,t)=E_t(-\frac{1}{e^{\gamma (x+qS_T)} })
\end{aligned}
$$

通过解这个方程[^1]得到

[^1]: [伊藤公式的应用](/数学/金融/2019/04/29/做市商策略模型.html)

$$
\begin{aligned}
    U(x,S,q,t) = -\frac{1}{e^{\gamma (x+qS)}}\cdot e^{\frac{\gamma^2q^2\sigma^2(T-t)}{2}} 
\end{aligned}
$$

基于这个效用函数，我们可以定义两个概念，保留买价（Reserve Bid Price），保留卖价（Reserve Ask Price）

$$
\begin{aligned}
    U(x-p^b(S,q,t),s,q+1,t) &= U(x,S,q,t)\\
    U(x+p^a(S,q,t),s,q-1,t) &= U(x,S,q,t)
\end{aligned}
$$

使得上面两个方程成立的$$p^b$$和$$p^a$$就是保留买价和保留卖价，解得：

$$
\begin{aligned}
    p^a(S,q,t) &= S + (1-2q)\frac{\gamma^2\sigma^2(T-t)}{2}\\
    p^b(S,q,t) &= S + (-1-2q)\frac{\gamma^2\sigma^2(T-t)}{2}
\end{aligned}
$$

可以看出$$p^a$$是严格大于$$p^b$$

### 4. 限价单模型

交易者在中间价周围发出订单，买单(bid)价格为$$p^b$$，卖单(ask)价格为$$p^a$$。
如果$$\delta < \varDelta p$$则认为投资者的订单成交了。

另外一个很重要的点在于，投资者的挂单行为并不是每次挂单总能有其他人的订单来“撞”完。假设市场上买方的订单来“撞”投资者的卖单的速率满足泊松过程
$$N^a = \lambda^a(\delta^a)$$，同理卖方的订单的速率为$$N_b = \lambda^b(\delta^b)$$。因此投资者的财富满足方程：

$$
\begin{aligned}
    dx_t =& p^adN^a_t-p^bdN^b_t\\
    q_t =& N_t^b - N_t^a
\end{aligned}
$$

投资者的<span id="jump">目标函数</span>是


$$
U(x,S,q,t)=\max_{\delta_a,\delta_b}{E_t(-\frac{1}{e^{\gamma (x+qS_T)}})}
$$

在解这个方程之前，我们需要假定泊松过程的形式，我们需要关注3个点：

1. 市场订单的频率$$\Lambda$$
2. 订单大小的分布$$f^a(x)$$
3. 短期冲击$$\varDelta p$$

简单起见，我们假设市场订单成交的频率$$\Lambda$$是一个常数，$$\Lambda$$可以用一整天的交易量除以平均订单大小来衡量

订单大小的分布假定服从$$f^a(x)\sim x^{-1-a}$$

短期冲击$$\varDelta p$$与$$\ln (Q)$$假设为线性函数$$\varDelta p = \frac{1}{k}\ln (Q)$$

那么$$\lambda(\delta)$$应该被描述为单位时间间隔内，市场订单价差大于设定价差的强度，因此有：

$$
\begin{aligned}
    \lambda(\delta) &=\Lambda\cdot P(\varDelta p > \delta)\\
    &=\Lambda\cdot P(\ln (Q) > k\delta)\\
    &=\Lambda\cdot P(Q > e^{k\delta})\\
    &=\Lambda\cdot \int_{e^{k\delta}}^\infty{x^{-1-a}\mathrm{d}x}\\
    &=A\cdot e^{-k\delta}
\end{aligned}
$$

至此，所有条件均已准备好，剩下的就是去解[目标函数](#jump)[^2]

[^2]: [Ho and Stoll(1981)](/数学/金融/2019/04/29/做市商策略模型.html)