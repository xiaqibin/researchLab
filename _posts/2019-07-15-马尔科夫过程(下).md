---
layout: post
title:  马尔科夫过程（下）
category: [随机过程] 
hide: true
description: 这篇博文主要介绍马尔可夫过程中的一些问题和扩展
---

## 瞬时状态的平均时间

考虑一个有限状态马尔可链，假设其瞬时状态的转移矩阵为

$$
P_T = 
\begin{bmatrix}
    P_{11}&P_{12}&\cdots&P_{1t}\\
    \vdots&\vdots&\vdots&\vdots\\
    P_{t1}&P{t2}&\cdots&P_{tt}\\
\end{bmatrix}
$$

注意到所有的状态都是瞬时状态，因此每一行的概率小于1。

对于任意的状态$$i$$和$$j$$，令$$s_{ij}$$定义为从状态$$i$$开始，马尔可夫链处于状态$$j$$的期望次数；同时，令$$\delta_{ij}=1$$如果$$i=j$$，否则，令$$\delta_{ij}=0$$，那么有

$$
\begin{aligned}
    s_{ij}& = \delta_{ij} + \sum_{k}{P_{ik}s_{kj}}\\
    & = \delta_{ij} + \sum_{k=1}^{t}{P_{ik}s_{kj}}
\end{aligned}
$$

这个等式很好理解，从状态$$i$$开始，如果$$j=i$$，那么这次开始的时候正好就已经满足了一次，则需要加1，另外，从$$i$$到$$j$$，需要经过一次$$k$$，到达$$k$$的概率为$$P_{ik}$$，到达$$k$$后，问题则变成从状态$$k$$到状态$$j$$的次数。

另外，需要注意的是，如果状态$$k$$是常返态，那么它不可能会返回到瞬过态，因此$$P_{kj} = 0$$

因此我们定义$$S$$为$$s_{ij}$$的矩阵

$$
S = 
\begin{bmatrix}
    s_{11}&s_{12}&\cdots&s_{1t}\\
    \vdots&\vdots&\vdots&\vdots\\
    s_{t1}&s{t2}&\cdots&s_{tt}\\
\end{bmatrix}
$$

那么有等式：

$$
S = I + P_{T}S
$$

可以解得

$$
S = (I-P_T)^{-1}
$$

## 扩散过程

扩散过程是马尔可夫链的一个类别，在生物学，社会学，以及工程学上有广泛应用。

一个比较著名的例子是，人口增长模型，假设在一个人口模型中，个体会在死之后留下$$j$$个后代，且概率为$$P_j\geq 0$$，且与其他个体相互独立。

个体的数量初始我们记为$$X_0$$，称为第0代个体的规模，所有第0代的后代组成了第1代，他们的规模记为$$X_1$$。一般地，记$$X_n$$为第n代的规模，那么随机过程$$\{X_n\vert n=0,1,2,\cdots\}$$是一个马尔科夫链，状态的取值范围是非负整数。

注意到，状态0是一个常返态，因为很明显$$P_{00}=1$$（因为没有个体了，也就不会有下一代了），且如果$$P_0>0$$即每个个体都有几率没有下一代，那么其他所有的状态都是瞬过态，因为$$P_{i0} = P_0^i>0$$，那么对于状态$$i$$，都有大于0的概率再也回不到状态$$i$$了。可以得到另一个结论，任意的瞬过态的有限集都只能出现有限次，因此得到重要的结论，如果$$P_0>0$$，那么总人口要么灭绝，要么收敛到无穷，不会收敛到某一个有限数值上。

令$$\mu = \sum_{j=0}^{\infty}jP_j$$，表示个体的后代的期望数量。令$$\sigma^2 = \sum_{j=0}^{\infty}(j-\mu)P_j$$表示个体后代数量的方差。

我们假设初始数量为1,$$X_0=1$$，我们可以得到

$$
X_n = \sum_{i=1}^{X_{n-1}}{Z_i}
$$

$$Z_i$$表示第n-1代中第i个个体的后代数量。那么，根据条件期望公式，我们有

$$
\begin{aligned}
    E[X_n] &= E[E[X_n\vert X_{n-1}]]\\
    &=E[E[ \sum_{i=1}^{X_{n-1}}{Z_i\vert X_{n-1}}]]\\
    &=E[X_{n-1}\mu]\\
    &=\mu E[X_{n-1}]
\end{aligned}
$$

同理，也可以得到$$X_n$$的方差

$$Var(X_n) = E(X_{n-1})\sigma^2+\mu^2Var(X_{n-1})$$

根据数列的递推公式，得到

$$
\begin{aligned}
    &E[X_n]=\mu^n\\
    &Var(X_n)=\begin{cases}
        \sigma^2\mu^{n-1}(\frac{1-\mu^n}{1-\mu})&\mu\neq 1\\
        n\sigma^2&\mu=1\\
    \end{cases}
\end{aligned}
$$

令$$\pi_0$$表示群体最终灭绝的概率

$$
\pi_0 = \lim_{n\rightarrow \infty}{P\{X_n=0\vert X_0=1\}}
$$

我们首先注意到如果$$\mu <1$$，那么$$\pi_0 = 1$$

$$
\begin{aligned}
    \mu^n = E[X_n]&=\sum_{j=1}^{\infty}{jP\{X_n=j\}}\\
    &\geq \sum_{j=1}^{\infty}{1P\{X_n=j\}}\\
    &=P{X_n\geq 1}
\end{aligned}
$$

对于$$\mu=1$$上述关系仍然成立，对于$$\mu>1$$，我们从另一个角度来分析它

我们对于$$pi_0$$的定义可以如下表示：

$$
\begin{aligned}
    \pi_0 &= P\{\text{群体灭绝}\}\\
    &=\sum_{j=0}^{\infty}{P\{\text{群体灭绝}\vert X_1=j\}P_j}
\end{aligned}
$$

意思代表的是如果群体灭绝，那么给定第一代，是其条件概率的和。那么我们注意到，如果一个群体灭绝，那么对于第一代中的所有个体的后代都会灭绝，而每个个体的发展是相互独立的，因此有

$$
P\{\text{群体灭绝}\vert X_1=j\} = pi_0^j
$$

那么上述公式就可以写为

$$
\pi_0 = \sum_{j=0}^{\infty}{\pi_0^jP_j}
$$

## 可逆马尔科夫过程

定义

$$
\begin{aligned}
    Q_{ij} &= P\{X_m=j\vert X_{m+1}=i\}\\
    &=\frac{P\{X_m=j,X_{m+1}=i\}}{P\{X_{m+1}=i\}}\\
    &=\frac{P\{X_m=i\}P\{X_{m+1}=i\vert X_m=j\}}{P\{X_{m+1}=i\}}\\
    &=\frac{\pi_jP_{ji}}{\pi_i}
\end{aligned}

$$

为了证明反转过程也是马尔科夫过程，我们必须要证明

$$
P\{X_m=j\vert X_{m+1}=i,X_{m+2},X_{m+3},\cdots\} = P\{X_m=j\vert X_{m+1}=i\}
$$

假设现在的时间是$$m+1$$时刻，由于$$X_1,X_2,X_3\cdots $$是马尔科夫链，那么给定$$X_{m+1}$$，$$X_{m+2},X_{m+3},\cdots$$都是独立于$$X_m$$，反过来说，给定$$X_{m+1}$$，$$X_m$$独立于$$X_{m+2},X_{m+3},\cdots$$，即可证明。

所以，反转过程也是马尔科夫链，且其转移概率

$$
Q_{ij} = \frac{\pi_jP_{ji}}{\pi_i}
$$

如果$$Q_{ij} = P_{ij}$$，那么我们称马尔科夫链是**时间可逆**的。根据$$Q_{ij}$$的表达式，我们也可以得到，可逆条件

$$
\pi_i P_{ij} = \pi_j P_{ji}
$$

这一条件代表的是，从状态$$i$$转移到状态$$j$$的概率$$(\pi_i P_{ij})$$等于从状态$$j$$转移到状态$$i$$的概率$$( \pi_j P_{ji})$$，这是一个很明显的可逆的条件，状态$$i$$与状态$$j$$可逆，就像是跳棋一样，从一个洞跳到另一个洞与从另一个洞反向跳回是等价（概率相等）的。

另外，这一个条件还可以用来计算马尔科夫过程的极限概率。如果我们可以找到一组大于0的数,满足

$$
\begin{aligned}
    &\forall i,j, x_iP_{ij} = x_jP_{ji}\\
    & \sum_{k=1}{x_k} = 1
\end{aligned}

$$

都成立，那么其解$$\{x_i\}$$就是过程的极限概率。

定理1：**如果一个遍历马尔科夫过程是可逆的(若$$P_{ij}=0$$，有$$P_{ji}=0$$)，当且仅当**

$$P_iP_{ii_1}\cdots P_{i_1i}P_i = P_iP_{ii_1}\cdots P_{i_1i}P_i$$

推论：**如果一个不可约马尔科夫过程，存在$$\pi_i$$和$$Q$$，满足下列公式，则其逆过程的转移矩阵和极限概率就是$$Q$$和$$pi$$**

$$
\begin{aligned} 
    &\pi_iP_{ij} = \pi_jQ{ji}\\
    &\sum_{i}\pi_i = 1
\end{aligned}   
$$

## 马尔科夫蒙特卡罗方法

另$$\mathbf{X}$$是离散随机向量，其值为$$\mathbf{x_j},j\geq 0$$，$$\mathbf{X}$$的概率质量函数为$$P\{\mathbf{X}=\mathbf{x_j}\}$$，我们对于下面这个指标感兴趣

$$\theta = E[h(\mathbf{X})] = \sum_{j=1}{h(\mathbf{x_j})P(\mathbf{X}=\mathbf{x_j})}$$

对于某些场景，很难计算出$$h(\mathbf{x_j})$$，这时，我们可以通过模拟来估计$$\theta$$，一种常用的方法是**蒙特卡罗模拟**，通过产生一些随机数，使得随机数满足特定的概率质量函数（概率分布函数）。
根据强大数定律

$$\theta = \lim_{n\rightarrow \infty}{\sum_{i=1}^{n}{\frac{h(\mathbf{x_n})}{n}}}$$

通常来说，这一方法的难点在于如何产生特定概率质量函数的随机数向量，尤其是非独立随机数的向量。我们可以换一种思路，可以模拟一个过程，只需要其在每种状态下的极限概率等于概率质量函数即可。

下面是一种给定极限概率，模拟随机过程的一种算法

1. 初始化一个任意给定的不可约马尔科夫过程转移矩阵$$Q$$,其$$i$$行$$j$$列的元素为$$q(i,j)$$
2. 生成一个过程，如果过程$$X_n,n\geq 1$$等于$$i$$，那么生成一个随机变量$$Y$$，使得$$P(Y=j)=p(i,j)$$，如果$$Y=j$$，那么设置$$X_{n+1}$$以概率$$\alpha(i,j)$$取值为$$j$$，以概率$$1-\alpha(i,j)$$取值为$$i$$
3. 可以知道，$$X_n$$的转移概率为$$P_{ij}=q(i,j)\alpha(i,j),P_{ii} = q(i,i)+\sum_{i\neq k}{q(i,k)(1-\alpha(i,k))}$$，通过可逆马尔科夫的条件$$\pi_iP_{ij} = \pi_jP_{ji},j\neq i$$得到条件$$ \pi_i q(i,j)\alpha(i,j) = \pi_jq(j,i)\alpha(j,i)$$
4. 令$$\displaystyle \alpha(i,j) = \min(\frac{\pi_jq(j,i)}{\pi_iq(i,j)},1)$$则可以满足上述条件